<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>

    <link rel="icon" href="favicon.ico" />

    <link href="../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <link href="../stylesheets/navio.css" rel="stylesheet" type="text/css" media="all" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="../javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="includes includes_stuff">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" alt="Logo" />
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="misc-mechanisms-and-few-boring-stuff">Misc mechanisms (and few boring stuff)</h1>

<h2 id="multiple-journeys">Multiple journeys</h2>

<p>Navitia can compute several kind of journeys with a journey query.</p>

<p>The
<a href="http://research.microsoft.com/apps/pubs/default.aspx?id=156567">RAPTOR</a>
algorithm used in Navitia is a multi-objective algorithm. Thus it might
return multiple journeys if it cannot know that one is better than the
other. For example it cannot decide that a one hour journey with no
connection is better than a 45 minutes journey with one connection
(it is called the <a href="http://en.wikipedia.org/wiki/Pareto_efficiency">pareto front</a>).
The 3 objectives Navitia uses are roughly the arrival datetime, the number of transfers
and the duration of &ldquo;walking&rdquo; (transfers and fallback).</p>

<p>If the user asks for more journeys than the number of journeys given by
RAPTOR (with the parameter <code class="prettyprint">min_nb_journeys</code> or <code class="prettyprint">count</code>), Navitia will
ask RAPTOR again, but for the following journeys (or the previous ones
if the user asked with <code class="prettyprint">datetime_represents=arrival</code>).</p>

<p>Those journeys have the <code class="prettyprint">next</code> (or <code class="prettyprint">previous</code>) value in their tags.</p>

<h2 id="journey-qualification-process">Journey qualification process</h2>

<p>Since Navitia can return several journeys, it tags them to help the user
choose the best one that matches their needs.
Here are some tagging rules:
-    there is only one &ldquo;best&rdquo; itinerary
-    itineraries with other types are displayed only if they are relevant
-    and for a specific type, you may find many relevant itinerary</p>

<p>For example, for a specific request, you can find the &ldquo;best&rdquo; itinerary, 2 &ldquo;less_fallback_walk&rdquo; ones
(with less walking, but taking more time) and no &ldquo;comfort&rdquo; (the &ldquo;best&rdquo; one is the same as the &ldquo;comfort&rdquo; one for example).</p>

<p>The different journey types are:</p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>best</td>
<td>The best journey if you have to display only one.</td>
</tr>
<tr>
<td>rapid</td>
<td>A good trade off between duration, changes and constraint respect</td>
</tr>
<tr>
<td>comfort</td>
<td>A journey with less changes and walking</td>
</tr>
<tr>
<td>car</td>
<td>A journey with car to get to the public transport</td>
</tr>
<tr>
<td>less_fallback_walk</td>
<td>A journey with less walking</td>
</tr>
<tr>
<td>less_fallback_bike</td>
<td>A journey with less biking</td>
</tr>
<tr>
<td>less_fallback_bss</td>
<td>A journey with less bss</td>
</tr>
<tr>
<td>fastest</td>
<td>A journey with minimum duration</td>
</tr>
<tr>
<td>bike_in_pt</td>
<td>A journey with bike both at the beginning and the end, and where bike is allowed in public transport used</td>
</tr>
<tr>
<td>non_pt_walk</td>
<td>A journey without public transport, only walking</td>
</tr>
<tr>
<td>non_pt_bike</td>
<td>A journey without public transport, only biking</td>
</tr>
<tr>
<td>non_pt_bss</td>
<td>A journey without public transport, only bike sharing</td>
</tr>
</tbody></table>

<h2 id="service-translation"><a name=Service-translation></a>Service Translation</h2>

<p>When specifying a service in the data through <code class="prettyprint">calendar.txt</code> and <code class="prettyprint">calendar_dates.txt</code>, you might get surprised to see a different result from Navitia&rsquo;s response.</p>
<pre class="highlight shell"><code><span class="c"># Navitia's interpreted service response</span>
<span class="o">{</span>
    <span class="s2">"calendars"</span>: <span class="o">[</span>
       <span class="o">{</span>
            <span class="s2">"active_periods"</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">"begin"</span>: <span class="s2">"20200101"</span>,
                    <span class="s2">"end"</span>: <span class="s2">"20200130"</span>
                <span class="o">}</span>
            <span class="o">]</span>,
            <span class="s2">"week_pattern"</span>: <span class="o">{</span>
                <span class="s2">"monday"</span>: <span class="nb">false</span>,
                <span class="s2">"tuesday"</span>: <span class="nb">false</span>,
                <span class="s2">"wednesday"</span>: <span class="nb">false</span>,
                <span class="s2">"thursday"</span>: <span class="nb">false</span>,
                <span class="s2">"friday"</span>: <span class="nb">false</span>,
                <span class="s2">"saturday"</span>: <span class="nb">true</span>,
                <span class="s2">"sunday"</span>: <span class="nb">true</span>
            <span class="o">}</span>,
            <span class="s2">"exceptions"</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">"type"</span>: <span class="s2">"remove"</span>,
                    <span class="s2">"datetime"</span>: <span class="s2">"20200127"</span>
                <span class="o">}</span>
            <span class="o">]</span>
        <span class="o">}</span>
    <span class="o">]</span>
</code></pre>

<p>For instance, if you have a trip that:</p>

<ul>
<li>  occurs every Saturday of January 2020 (in your <code class="prettyprint">calendar.txt</code>)</li>
<li>  has 3 exceptions that <code class="prettyprint">add</code> the service the first 3 Sundays (<code class="prettyprint">calendar_dates.txt</code>)</li>
</ul>

<p>You might expect to have that same exact representation for your <code class="prettyprint">/vehicle_journeys</code>, but instead you find something different.</p>

<p>You expected to have 3 <code class="prettyprint">add</code> exceptions but you only have 1 <code class="prettyprint">remove</code>. Also, the week pattern is set to <code class="prettyprint">true</code> on Sunday even though your <code class="prettyprint">calendar.txt</code> said Saturday only.</p>

<p>This is due to a re-interpretation of the service pattern, with one specific goal :</p>

<aside class="notice">
 Navitia analyzes the input service and computes an equivalent pair of (week_pattern, exceptions) with the **smallest** number of exceptions
</aside>

<p>This means that Navitia will re-organise the input data, to produce a smaller and more comprehensive response that respects the semantics of the input data.</p>

<p>For more information about the algorithm (in French): <a href="https://github.com/TeXitoi/pinot2015presenter/blob/master/pres/pinot2015presenter-pres.pdf">https://github.com/TeXitoi/pinot2015presenter/blob/master/pres/pinot2015presenter-pres.pdf</a></p>

<h2 id="ridesharing"><a name="ridesharing-stuff"></a>Ridesharing</h2>
<pre class="highlight shell"><code>simplified output

<span class="o">{</span>
    <span class="s2">"journeys"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"requested_date_time"</span>: <span class="s2">"20180101T070000"</span>,
            <span class="s2">"sections"</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">"type"</span>: <span class="s2">"street_network"</span>,
                    <span class="s2">"mode"</span>: <span class="s2">"ridesharing"</span>,
                    <span class="s2">"from"</span>: <span class="s2">"A"</span>,
                    <span class="s2">"to"</span>: <span class="s2">"B"</span>,
                    <span class="s2">"departure_date_time"</span>: <span class="s2">"20180101T070000"</span>,
                    <span class="s2">"arrival_date_time"</span>: <span class="s2">"20180101T090000"</span>,
                    <span class="s2">"ridesharing_journeys"</span>: <span class="o">[</span>
                        <span class="o">{</span>
                            <span class="s2">"sections"</span>:[
                                <span class="o">{</span>
                                    <span class="s2">"from"</span>: <span class="s2">"A"</span>,
                                    <span class="s2">"to"</span>: <span class="s2">"A1"</span>,
                                    <span class="s2">"departure_date_time"</span>: <span class="s2">"20180101T063000"</span>,
                                    <span class="s2">"arrival_date_time"</span>: <span class="s2">"20180101T063000"</span>,
                                    <span class="s2">"type"</span>: <span class="s2">"crow_fly"</span>,
                                    <span class="s2">"mode"</span>: <span class="s2">"walking"</span>
                                <span class="o">}</span>,
                                <span class="o">{</span>
                                    <span class="s2">"from"</span>: <span class="s2">"A1"</span>,
                                    <span class="s2">"to"</span>: <span class="s2">"A2"</span>,
                                    <span class="s2">"departure_date_time"</span>: <span class="s2">"20180101T063000"</span>,
                                    <span class="s2">"arrival_date_time"</span>: <span class="s2">"20180101T093000"</span>,
                                    <span class="s2">"type"</span>: <span class="s2">"ridesharing"</span>
                                <span class="o">}</span>,
                                <span class="o">{</span>
                                    <span class="s2">"from"</span>: <span class="s2">"A2"</span>,
                                    <span class="s2">"to"</span>: <span class="s2">"B"</span>,
                                    <span class="s2">"departure_date_time"</span>: <span class="s2">"20180101T093000"</span>,
                                    <span class="s2">"arrival_date_time"</span>: <span class="s2">"20180101T093000"</span>,
                                    <span class="s2">"type"</span>: <span class="s2">"crow_fly"</span>,
                                    <span class="s2">"mode"</span>: <span class="s2">"walking"</span>
                                <span class="o">}</span>
                            <span class="o">]</span>
                        <span class="o">}</span>,
                        <span class="o">{</span>
                            ...
                        <span class="o">}</span>
                    <span class="o">]</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">"from"</span>: <span class="s2">"B"</span>,
                    <span class="s2">"to"</span>: <span class="s2">"C"</span>,
                    <span class="s2">"departure_date_time"</span>: <span class="s2">"20180101T090000"</span>,
                    <span class="s2">"arrival_date_time"</span>: <span class="s2">"20180101T100000"</span>,
                    <span class="s2">"type"</span>: <span class="s2">"public_transport"</span>
                <span class="o">}</span>
            <span class="o">]</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            ...
        <span class="o">}</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre>

<p>When requesting a journey, it is possible to request for a ridesharing fallback,
using <code class="prettyprint">first_section_mode</code> or <code class="prettyprint">last_section_mode</code>.
This may also be used to obtain a direct ridesharing journey (using <code class="prettyprint">max_ridesharing_duration_to_pt=0</code>).</p>

<p>This returns a journey only when one or multiple ridesharing ads are found, matching the request.</p>

<aside class="warning">
    This feature requires a specific configuration and an agreement from a ridesharing service provider.
    Therefore this service is available only for a few clients.
</aside>

<p>The journey from Navitia will then contain a section using the ridesharing mode.
Inside this section an attribute ridesharing_journeys contains one or multiple journeys
depicting specifically the ridesharing ads that could match the above section
and that could be proposed to the user.</p>

<h2 id="taxi"><a name="taxi-stuff"></a>Taxi</h2>

<aside class="warning">
    This feature is not available on all coverages, as it is dependent on other parameters of the coverage (how journeys are computed).
</aside>

<p>With this mode, your journey may contain taxi sections(fallback or direct path). The journey you will obtain is basically the same as a journey by car. The only difference is that with taxi as fallback mode, a buffer time (section &ldquo;waiting&rdquo;, defaulted to 5 min) will appear into the journey. The buffer time won&rsquo;t appear if the journey is a direct path. Depending on the calculator, the journey may pick up ways that are reserved for taxis on not.</p>

<h2 id="on-demand-transportation">On demand transportation</h2>

<p>Some transit agencies force travelers to call them to arrange a pickup at a particular place or stop point.</p>

<p>Besides, some stop times can be &ldquo;estimated&rdquo; <em>in data by design</em> :</p>

<ul>
<li>A standard GTFS contains only regular time: that means transport agencies should arrive on time :)</li>
<li>But navitia can be fed with more specific data, where &ldquo;estimated time&rdquo; means that there will be
no guarantee on time respect by the agency. It often occurs in suburban or rural zone.</li>
</ul>

<p>After all, the stop points can be standard (such as bus stop or railway station)
or &ldquo;zonal&rdquo; (where agency can pick you up you anywhere, like a cab).</p>

<p>That&rsquo;s some kind of &ldquo;responsive locomotion&rdquo; (ɔ).</p>

<p>So public transport lines can mix different methods to pickup travelers:</p>

<ul>
<li>  regular

<ul>
<li>  line does not contain any estimated stop times, nor zonal stop point location.</li>
<li>  No need to call too.</li>
</ul></li>
<li>  odt_with_stop_time

<ul>
<li>  line does not contain any estimated stop times, nor zonal stop point location.</li>
<li>  But you will have to call to take it.</li>
</ul></li>
<li>  odt_with_stop_point

<ul>
<li>  line can contain some estimated stop times, but no zonal stop point location.</li>
<li>  And you will have to call to take it.</li>
</ul></li>
<li>  odt_with_zone

<ul>
<li>  line can contain some estimated stop times, and zonal stop point location.</li>
<li>  And you will have to call to take it</li>
<li>  well, not really a public transport line, more a cab&hellip;</li>
</ul></li>
</ul>

<h2 id="disruptions">Disruptions</h2>

<p>In this paragraph, we will explain how the disruptions are displayed in the different APIs.</p>

<h3 id="publication-period-of-a-disruption">publication period of a disruption</h3>

<p>The publication period of a disruption is the period on which we want to display the disruption in navitia.</p>

<p>The creator of the disruption might not want the traveller to know of a disruption before a certain date (because it&rsquo;s too uncertain, secret, &hellip;)
The publication period is the way to control this.</p>

<h3 id="application-periods-of-a-disruption">application periods of a disruption</h3>

<p>The application periods are the list of periods on which the disruption is active.
For example it&rsquo;s the actual period when railworks are done and train circulation is cut.</p>

<h3 id="request-date">Request date</h3>

<p>The request date represents datetime for Journeys API, from_datetime for  Schedules API or now for the others APIs.
The default value is now.</p>

<h3 id="summary">Summary</h3>

<p>To sum up we display an impact if &lsquo;now&rsquo; is in the publication period.</p>

<p>The status of the impact depends only of &#39;now&rsquo; and is:</p>

<ul>
<li>&#39;active&rsquo; if &#39;now&rsquo; is inside an application period</li>
<li>&#39;future&rsquo; if &#39;now&rsquo; is not inside an application period and there is an application period after &#39;now&rsquo;</li>
<li>&#39;past&rsquo; otherwise</li>
</ul>

<table>
  <thead>
    <tr>
      <th align="center" colspan="2"></th>
      <th align="center"> </th>
      <th align="center" colspan="3">Show impacts </th>
      <th align="center"> </th>
    </tr>
    <tr>
      <th align="center">publication period </th>
      <th>Application period </th>
      <th align="center">Request date</th>
      <th align="center">disruptions API</th>
      <th align="center">traffic_reports & PtRef API</th>
      <th align="center">Journeys & Schedules API</th>
      <th align="center">Status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
    </tr>
    <tr>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center">date1 </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center">- </td>
      <td align="center">- </td>
      <td align="center">future </td>
    </tr>
    <tr>
      <td align="center">T </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
    </tr>
    <tr>
      <td align="center">| </td>
      <td align="center"> </td>
      <td align="center">date2 </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center"> </td>
      <td align="center">future </td>
    </tr>
    <tr>
      <td align="center">| </td>
      <td align="center">T </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
    </tr>
    <tr>
      <td align="center">| </td>
      <td align="center">| </td>
      <td align="center">date3 </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center">active </td>
    </tr>
    <tr>
      <td align="center">| </td>
      <td align="center">⊥ </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
    </tr>
    <tr>
      <td align="center">| </td>
      <td> </td>
      <td align="center">date4 </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center"> </td>
      <td align="center">passed </td>
    </tr>
    <tr>
      <td align="center">⊥ </td>
      <td> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
      <td align="center"> </td>
    </tr>
    <tr>
      <td align="center"> </td>
      <td> </td>
      <td align="center">date5 </td>
      <td align="center"><strong>Yes</strong> </td>
      <td align="center">- </td>
      <td align="center">- </td>
      <td align="center">passed </td>
    </tr>
  </tbody>
</table>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
